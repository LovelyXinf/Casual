var PgApi=function(a){var b=this;return this.siteUrl=a,this.requests=[],this.tokenRefreshTimeout=0,this.isLS=!1,this.init=function(){b.isLS="localStorage"in window&&null!==window.localStorage,b.token=b.getOption("token",!0)||""},this.request=function(a,c,d){b.requests.push({url:a,data:c,callback:d}),b.token?b.queue():b.refreshToken()},this.queue=function(){for(;b.requests.length>0;){var a=b.requests.splice(0,1)[0];a.data.token=b.token,b.query(a.url,a.data,a.callback)}},this.query=function(a,c,d){$.ajax({url:b.siteUrl+a,data:c,method:"post",dataType:"json",success:function(a){d(a.data)},error:function(a){b.refreshToken()}})},this.getToken=function(a){$.getJSON(b.siteUrl+"api/get_token",{},function(c){b.setOption("token",c.data.token,!0),a(c.data.token)})},this.refreshToken=function(){return b.tokenRefreshTimeout?!1:(b.tokenRefreshTimeout=1,void b.getToken(function(a){b.token=a,b.queue()}))},this.getUsers=function(a){b.request("api/users/get_users_data",{},function(b){var c=[];for(var d in b.items)c.push(b.items[d]);a(c)})},this.getNews=function(a){b.request("api/news/news_list",{},function(b){var c=[],d=0;for(var e in b.news){if(d>=3)break;c.push(b.news[d]),d++}a(c)})},this.getOption=function(a,c){if(a){c=c||!1;var d;if(b.isLS?d=localStorage[a]:(d=b.getCookie(a),c&&(d=LZString.decompress(d))),"string"!=typeof d)return null;try{return JSON.parse(d)}catch(e){return d}}},this.setOption=function(a,c,d){if(a){if(d=d||!1,"object"==typeof c){for(var e in c)c.hasOwnProperty(e)||delete c[e];c=JSON.stringify(storage)}else c=c.toString();"undefined"!=typeof c&&(b.isLS?localStorage[a]=c:(d&&(c=LZString.compress(c)),b.setCookie(a,c)))}},this.getCookie=function(a){var b=" "+document.cookie,c=" "+a+"=",d=null,e=0,f=0;return b.length>0&&(e=b.indexOf(c),-1!=e&&(e+=c.length,f=b.indexOf(";",e),-1==f&&(f=b.length),d=unescape(b.substring(e,f)))),d},this.setCookie=function(a,b,c,d,e,f){document.cookie=a+"="+escape(b)+(c?"; expires="+c:"")+(d?"; path="+d:"")+(e?"; domain="+e:"")+(f?"; secure":"")},b.init(),b}(siteUrl||"");window.pgapi=PgApi;